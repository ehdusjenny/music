import extract_audio
import parse_audio
from flask import Flask, request
from flask_cors import CORS
import base64
import json
app = Flask(__name__)
CORS(app)

#@app.route("/", methods=['POST'])
@app.route("/")
def hello():
    #print(request.form['foo'])
    return "Hello World!"

@app.route("/hello")
def hello2():
    return json.dumps([[1,2,3],[4,5,6]])

@app.route("/hello/<name>")
def hello3(name):
    return "Hello %s!" % name

@app.route("/dl/<vid_id>")
def download(vid_id):
    file_name = extract_audio.download_yt_video("https://www.youtube.com/watch?v=%s" % vid_id)
    chroma, sample_rate = parse_audio.compute_chroma(file_name)
    return json.dumps(chroma.tolist())

@app.route("/dummydata")
def dummy():
    return json.dumps([[0.4597358655189965, 0.5939106797802379, 0.6418648880946494,
            0.8711120449687269, 1.0, 0.7822618249527501, 0.5350022276659239,
            0.3892168573466195, 0.4055571379606504, 0.46724229625408475,
            0.4730835810043081, 0.5174204423103783, 0.5309993748229362,
            0.7566273063674426, 0.7779970943749623, 0.6911364424005616,
            0.8447112823108442, 0.7902274426034468, 0.7883767908881254,
            0.8180197615627158, 0.7548718722513458, 0.6875053012242898,
            0.6916204025509753, 0.5436067142223139, 0.4665024407817943,
            0.5450102045462185, 0.8843186014612965, 0.8970172364659026,
            0.840656641455527, 0.881770309954486, 0.8533503732960609,
            0.7857717010001706, 0.7030839698866101, 0.6640844410786174,
            0.6246474710944329, 0.523792360120758, 0.4641680057003321,
            0.4381484371711592, 0.5525779405762132, 0.5592483386000427,
            0.21626084588296204, 0.08414959968150007, 0.10410733963156937,
            0.07838676186078221, 0.07849081923090703, 0.0918890608819775,
            0.0860033604199279, 0.06972039624177613, 0.1199912695466134,
            0.19382675594931326, 0.21510992568721807, 0.16478381930075903,
            0.3096342926232016, 0.2791804704705836, 0.19382767618276583,
            0.22904970681188774, 0.1910878317137293, 0.19934365850042618,
            0.1584883733288079, 0.07556203912895286, 0.0643830085442285,
            0.10439090179138932, 0.13027049252655504, 0.270889728273779,
            0.38484912173561775, 0.15816574022083807, 0.09396410628336652,
            0.07537022593635481, 0.0848027764463794, 0.09846599557560715,
            0.09338613349092204, 0.08529508241453646, 0.1125918521424682,
            0.11143978357810357, 0.14743350591702878, 0.18216088428402646,
            0.20383722976548402, 0.313053639759486, 0.3474942112202812,
            0.185779469651692, 0.09978961858456808, 0.0965796232449433,
            0.09706244561117434, 0.08277526894492976, 0.06658251196032296,
            0.08883842764424614, 0.13927756939730226, 0.17531933038866568,
            0.24817500180075378, 0.40965848531496873, 0.626868210368394,
            0.42925761804753687, 0.34156726952456024, 0.3550190446104157,
            0.25826711067464664, 0.2218071798752632, 0.27634084844277007,
            0.274076885150673, 0.28622928579725776, 0.30612784926995157,
            0.2858975231727781, 0.26297694809886096, 0.30578434188802966,
            0.18948042488316286, 0.13093762464973532, 0.19154033086461197,
            0.2599103640403102, 0.3304994037761948, 0.40162409417411293,
            0.4937624353457576, 0.6031827439573433, 0.7171550467512643,
            0.6744109126132218, 0.4237731855283293, 0.3495636944226103,
            0.5030526151295562, 0.4956907220482503, 0.4289540430237115,
            0.3954721713630409, 0.39161582414227775, 0.3633499557685401,
            0.32515721972399514, 0.29546254253669324, 0.2505325948643723,
            0.20590750791152976, 0.1402078753315433, 0.11018882693096965,
            0.16901892348852582, 0.10158566416951964, 0.13023371208309675,
            0.10905516024817415, 0.11434615640411494, 0.09298518831878698,
            0.10605073060930252, 0.11059795918352344, 0.10351884216527915,
            0.11147188769187671, 0.1316679598559696, 0.1550304537771283,
            0.1392954367129189, 0.14827962993865104, 0.19082849772588806,
            0.3466969560667454, 0.26017318617503626, 0.1840946218893666,
            0.39294612660369704, 0.3447283235132775, 0.19073992824142508,
            0.16518418503492052]])

if __name__ == "__main__":
    app.run(host="0.0.0.0", port="5000")
